# scanner.py
import subprocess
import sys
import shutil
import json

from . import config   # relative import for configuration
from . import utils    # relative import for helper functions like temp files

try:
    from vulnerability import config
except Exception:
    config = {}

def run_bandit(path: str) -> dict:
    """Run Bandit on a file and return JSON results."""
    bandit_cmd = shutil.which("bandit") or None
    if bandit_cmd:
        cmd = [bandit_cmd, "-r", path, "-f", "json"]
    else:
        cmd = [sys.executable, "-m", "bandit", "-r", path, "-f", "json"]

    completed = subprocess.run(cmd, capture_output=True, text=True, check=False)
    if completed.returncode not in (0,1):
        raise RuntimeError(f"Bandit failed: {completed.stderr}")
    
    return json.loads(completed.stdout)
